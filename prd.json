{
  "name": "Todo API",
  "description": "A simple REST API for managing todos, built with Bun and TypeScript. This is a test project to validate the ralph loop with a real agent.",

  "validate": [
    "bun test",
    "bun run typecheck"
  ],

  "tasks": [
    {
      "id": "init-project",
      "name": "Initialize Bun project",
      "description": "Initialize a Bun TypeScript project. Create package.json with bun as the runtime and add a tsconfig.json with strict mode enabled. Add a 'typecheck' script that runs 'tsc --noEmit'. Create a src/ directory with an empty src/index.ts entry point. Make sure 'bun run typecheck' passes.",
      "acceptanceCriteria": [
        "package.json exists with a 'typecheck' script",
        "tsconfig.json exists with strict mode",
        "src/index.ts exists",
        "bun run typecheck passes"
      ],
      "validate": [
        "bun run typecheck"
      ]
    },
    {
      "id": "todo-model",
      "name": "Create Todo type and in-memory store",
      "description": "Create src/types.ts with a Todo interface: { id: string, title: string, completed: boolean, createdAt: string }. Create src/store.ts with an in-memory store that exports functions: getAllTodos(), getTodoById(id), createTodo(title), updateTodo(id, updates), deleteTodo(id). Use a Map internally. Write tests in test/store.test.ts covering all CRUD operations.",
      "dependsOn": ["init-project"],
      "acceptanceCriteria": [
        "Todo interface is defined in src/types.ts",
        "src/store.ts exports all 5 CRUD functions",
        "Tests exist in test/store.test.ts",
        "bun test passes"
      ],
      "validate": [
        "bun test",
        "bun run typecheck"
      ]
    },
    {
      "id": "api-endpoints",
      "name": "Build HTTP API endpoints",
      "description": "Create src/server.ts using Bun.serve() with the following JSON API routes: GET /todos (list all), GET /todos/:id (get one, 404 if missing), POST /todos with { title } body (returns 201), PATCH /todos/:id with { title?, completed? } body, DELETE /todos/:id (returns 204). Use the store from src/store.ts. Export the server creation as a function so tests can use it. Update src/index.ts to start the server on port 3000.",
      "dependsOn": ["todo-model"],
      "acceptanceCriteria": [
        "All 5 REST endpoints work",
        "POST returns 201 with the created todo",
        "GET for missing todo returns 404",
        "DELETE returns 204",
        "Server starts on port 3000"
      ],
      "validate": [
        "bun run typecheck"
      ]
    },
    {
      "id": "api-tests",
      "name": "Write API integration tests",
      "description": "Create test/api.test.ts with integration tests for the HTTP API. Start the server on a random available port before tests and stop it after. Test the full lifecycle: create a todo via POST, verify it appears in GET /todos, update it via PATCH, verify the update, delete it via DELETE, verify GET returns 404. Also test error cases: GET /todos/nonexistent returns 404, POST with empty body returns 400.",
      "dependsOn": ["api-endpoints"],
      "acceptanceCriteria": [
        "test/api.test.ts has integration tests",
        "Happy path lifecycle is tested (create, read, update, delete)",
        "Error cases are tested (404, 400)",
        "bun test passes with all tests green"
      ],
      "validate": [
        "bun test",
        "bun run typecheck"
      ]
    }
  ]
}
